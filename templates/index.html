<!DOCTYPE html>
<html>
<head>
    <title>MeTube - {{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="sidebar">
        <h2 style="padding-left: 24px;">MeTube</h2>
        <a href="/">Home</a>
        <a href="/subscriptions">Subscriptions</a>
    </div>

    <div class="main-content">
        <h1>{{ title }}</h1>
        <div class="video-grid">
            {% for vid in videos %}
            <div class="video-card" onclick="openPlayer('{{ vid.path }}')">
                <div class="thumbnail-container" 
                     onmouseenter="startHover(this, '{{ vid.path }}')" 
                     onmouseleave="stopHover(this, '{{ vid.id }}')">
                    <img src="/thumbnail/{{ vid.id }}" id="img-{{ vid.id }}">
                </div>
                <div class="video-info">
                    <div class="video-title">{{ vid.title }}</div>
                    <div class="video-meta">{{ vid.channel }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="player-modal">
        <div style="width: 80%;">
            <video id="main-player" controls></video>
            <div class="controls">
                <label>Speed: </label>
                <select id="speed-ctrl" onchange="changeSpeed(this.value)">
                    <option value="0.5">0.5x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                    <option value="3">3x</option>
                </select>
                <button onclick="closePlayer()" style="margin-left: 20px;">Close</button>
            </div>
        </div>
    </div>

    <script>
        const hoverEnabled = {{ 'true' if hover_play else 'false' }};
        
        function startHover(container, path) {
            if(!hoverEnabled) return;
            const video = document.createElement('video');
            video.src = '/video_file/' + path;
            video.muted = true;
            video.autoplay = true;
            video.loop = true;
            video.style.position = 'absolute';
            video.style.top = '0';
            video.style.left = '0';
            container.appendChild(video);
        }

        function stopHover(container, id) {
            const vid = container.querySelector('video');
            if(vid) container.removeChild(vid);
        }

        function openPlayer(path) {
            const modal = document.getElementById('player-modal');
            const player = document.getElementById('main-player');
            player.src = '/video_file/' + path;
            modal.style.display = 'flex';
            player.play();
        }

        function closePlayer() {
            const modal = document.getElementById('player-modal');
            const player = document.getElementById('main-player');
            player.pause();
            modal.style.display = 'none';
        }

        function changeSpeed(val) {
            document.getElementById('main-player').playbackRate = parseFloat(val);
        }
    </script>
</body>
</html>